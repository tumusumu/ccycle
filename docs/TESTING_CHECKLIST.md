# 🧪 ccycle v1.0.0 功能测试清单

> 测试时间：2026-02-04  
> 测试环境：https://suton.cn  
> 版本：v1.0.0 MVP (Commit: bdec0d4)

---

## 📋 测试结果概览

| 模块 | 测试项 | 状态 | 备注 |
|------|--------|------|------|
| 🔐 认证系统 | 7项 | 🔄 待测试 | - |
| 👤 用户管理 | 4项 | 🔄 待测试 | - |
| 📅 计划系统 | 5项 | 🔄 待测试 | - |
| 🍽️ 营养追踪 | 8项 | 🔄 待测试 | - |
| 💪 运动记录 | 4项 | 🔄 待测试 | - |
| 🎯 控糖打卡 | 4项 | 🔄 待测试 | - |
| 📊 数据展示 | 5项 | 🔄 待测试 | - |
| 🔒 数据隔离 | 6项 | 🔄 待测试 | - |
| 🚪 退出登录 | 5项 | ✅ 代码验证 | - |

**总计**: 48 个测试项

---

## 1️⃣ 认证系统测试

### 用户注册
- [ ] **注册页面加载**
  - 访问 `/register`
  - 检查表单元素显示完整
  - 确认 Logo 和标题正确

- [ ] **用户名验证**
  - 输入不合法用户名（含特殊字符）→ 应显示错误
  - 输入已存在用户名 → 应显示"用户名已被占用"
  - 输入合法新用户名 → 应显示"✓ 用户名可用"（绿色）
  - 实时验证（防抖 500ms）

- [ ] **密码强度指示**
  - 输入弱密码（如"123"）→ 应显示"弱"（红色）
  - 输入中等密码（如"test123"）→ 应显示"中等"（黄色）
  - 输入强密码（如"Test@123456"）→ 应显示"强"（绿色）
  - 进度条颜色正确变化

- [ ] **确认密码验证**
  - 两次密码不一致 → 应显示错误
  - 两次密码一致 → 应显示"✓ 密码一致"（绿色）

- [ ] **注册按钮状态**
  - 表单未完成 → 按钮禁用（灰色）
  - 表单验证通过 → 按钮启用（蓝色）

- [ ] **注册流程**
  - 点击注册按钮
  - 显示"加载中..."
  - 注册成功 → 自动跳转到 `/onboarding`
  - Cookie 已设置（双重 cookie）

- [ ] **密码显示/隐藏**
  - 点击眼睛图标
  - 密码在明文/密文间切换

### 用户登录
- [ ] **登录页面加载**
  - 访问 `/login` 或 `/`
  - 表单元素显示完整

- [ ] **登录验证**
  - 输入错误用户名 → 应显示"用户名或密码错误"
  - 输入错误密码 → 应显示"用户名或密码错误"
  - 输入正确凭证 → 登录成功，跳转到 `/dashboard`

- [ ] **登录后状态**
  - Cookie 已设置
  - 用户信息已加载
  - 无法再访问 `/login`（自动跳转）

---

## 2️⃣ 用户管理测试

### 个人信息完善
- [ ] **Onboarding 页面**
  - 注册后自动进入
  - 显示"欢迎，[用户名]！"
  - 表单字段：出生年份、性别、体重、体脂率

- [ ] **数据验证**
  - 年龄验证：18-80岁
  - 体重验证：40-150kg
  - 体脂率验证：5-45%
  - 未登录用户 → 跳转到注册页

- [ ] **提交流程**
  - 填写完整信息
  - 点击"下一步"
  - 成功 → 跳转到 `/plan/new`

### 用户信息更新
- [ ] **更新个人信息**
  - 修改体重、体脂率
  - 数据保存到数据库
  - 立即生效

---

## 3️⃣ 计划系统测试

### 创建计划
- [ ] **新建计划页面**
  - 访问 `/plan/new`
  - 显示开始日期选择器
  - 默认日期为今天

- [ ] **日期验证**
  - 选择过去日期 → 应显示错误
  - 选择今天或未来日期 → 应允许

- [ ] **创建流程**
  - 选择开始日期
  - 点击"创建计划"
  - 成功 → 跳转到 `/dashboard`
  - 数据库创建 CyclePlan 和 DailyMealPlan 记录

### 查看计划
- [ ] **日历页面** (`/plan`)
  - 显示6天周期视图
  - 低碳日（绿色）、中碳日（黄色）、高碳日（红色）
  - 周期导航（上一周期/下一周期）
  - 周期统计卡片（进度条、激励文案）

- [ ] **日期点击详情**
  - 点击任意日期
  - 弹出 Modal 显示详情
  - 显示营养摄入（碳水/蛋白质/脂肪/热量）
  - 显示运动记录
  - 显示控糖打卡状态（如果有数据）

---

## 4️⃣ 营养追踪测试

### 早餐录入
- [ ] **早餐页面** (`/meals/breakfast`)
  - 显示燕麦、全蛋、蛋白输入框
  - 显示参考份量
  - 数字输入框正常工作

- [ ] **数据保存**
  - 填写数据
  - 点击"✓ 确认完成"
  - 成功 → 跳转到 `/dashboard`
  - 数据保存到 DailyIntakeRecord

### 其他餐食录入
- [ ] **午餐录入** (`/meals/lunch`)
  - 米饭、肉类类型、肉类重量、橄榄油
  - 保存成功

- [ ] **加餐录入** (`/meals/snack`)
  - 米饭、蛋白质类型、蛋白质重量
  - 保存成功

- [ ] **晚餐录入** (`/meals/dinner`)
  - 米饭、肉类类型、肉类重量、橄榄油
  - 保存成功

### 历史记录补充
- [ ] **访问历史记录页面**
  - 从日历点击未记录的日期
  - 点击"📝 补充录入打卡"
  - 跳转到 `/history/[date]`

- [ ] **历史记录页面内容**
  - 显示日期和碳水类型
  - 显示营养进度环
  - 显示6个任务卡片（早/午/加/晚/力量/有氧）
  - 显示控糖打卡卡片

- [ ] **历史数据录入**
  - 点击早餐卡片
  - URL 带参数：`/meals/breakfast?date=2026-02-03`
  - 填写数据并保存
  - 返回历史页面 → 任务状态更新为"✓ 已完成"
  - 返回日历 → 该日期显示为已记录状态

- [ ] **数据持久化**
  - 刷新页面
  - 历史数据仍然存在
  - 日历显示正确

---

## 5️⃣ 运动记录测试

### 力量训练
- [ ] **力量训练页面** (`/exercise/strength`)
  - 显示时长输入框
  - 保存成功

### 有氧训练
- [ ] **有氧训练页面** (`/exercise/cardio`)
  - 显示时长输入框
  - 保存成功

### 运动记录显示
- [ ] **Dashboard 显示**
  - 今日运动记录显示在卡片中

- [ ] **日历详情显示**
  - 点击有运动记录的日期
  - Modal 显示运动记录（力量XX分钟/有氧XX分钟）

---

## 6️⃣ 控糖打卡测试

### 今日控糖打卡
- [ ] **Dashboard 显示**
  - 显示控糖打卡卡片（如果是第一个月）
  - 三项指标：🍎🍬🍞

### 历史控糖打卡
- [ ] **历史记录页面**
  - 显示控糖打卡卡片
  - 点击切换打卡状态
  - 实时保存到数据库

- [ ] **日历详情显示**
  - 点击已打卡的日期
  - Modal 显示控糖打卡状态
  - 显示"✓ 已确认"或"未确认"

- [ ] **数据持久化**
  - 刷新页面后数据仍存在
  - 不同日期数据独立

---

## 7️⃣ 数据展示测试

### Dashboard (今日)
- [ ] **页面加载**
  - 显示碳水类型 Badge（低/中/高）
  - 显示"第X天"
  - 显示营养进度环（4个）

- [ ] **营养进度环**
  - 碳水、蛋白质、脂肪、卡路里
  - 百分比计算正确
  - 颜色根据完成度变化
  - 超标显示红色渐变背景

- [ ] **退出按钮**
  - 右上角显示退出图标
  - 点击退出 → 清除 cookie → 跳转登录页

### Stats (统计)
- [ ] **趋势图显示**
  - 体重和体脂率曲线图
  - 时间筛选（7天/30天/全部）
  - 数据点正确显示

- [ ] **退出按钮**
  - 显示并正常工作

---

## 8️⃣ 数据隔离测试

### 多用户隔离
- [ ] **注册第一个用户**
  - 注册 testuser0204
  - 创建计划
  - 录入今日数据

- [ ] **注册第二个用户**
  - 登出 testuser0204
  - 注册 testuser0205
  - 创建计划
  - **验证：不应该看到 testuser0204 的数据**

- [ ] **切换用户**
  - 登出 testuser0205
  - 登录 testuser0204
  - **验证：应该看到自己的数据，不是 testuser0205 的**

### Cookie 隔离
- [ ] **Cookie 设置**
  - 注册/登录后设置 `ccycle_user_id` (httpOnly)
  - 注册/登录后设置 `ccycle_user_id_client`
  - 两个 cookie 都设置成功

- [ ] **Cookie 清除**
  - 点击退出按钮
  - 两个 cookie 都被清除
  - localStorage 中的 `intake-*` 数据被清除

### 数据库隔离
- [ ] **数据查询**
  - 所有 API 使用 `getCurrentUser()` 验证
  - 查询时带 `where: { userId: user.id }` 或通过外键关联
  - 不同用户数据完全独立

---

## 9️⃣ 退出登录测试

### Dashboard 页面退出
- [ ] **退出按钮显示**
  - 访问 `/dashboard`
  - 右上角显示退出图标

- [ ] **退出流程**
  - 点击退出按钮
  - 显示"加载中..."状态（防重复点击）
  - Cookie 被清除
  - 跳转到 `/login`

### Plan 页面退出
- [ ] **退出按钮显示**
  - 访问 `/plan`
  - 右上角显示退出图标

- [ ] **退出流程**
  - 点击退出按钮
  - 正常退出并跳转

### Stats 页面退出
- [ ] **退出按钮显示**
  - 访问 `/stats`
  - 右上角显示退出图标

- [ ] **退出流程**
  - 点击退出按钮
  - 正常退出并跳转

### Settings 页面退出
- [ ] **退出按钮显示**
  - 访问 `/settings`
  - 右上角显示退出图标

- [ ] **退出流程**
  - 点击退出按钮
  - 正常退出并跳转

### 退出后验证
- [ ] **访问受保护页面**
  - 退出后访问 `/dashboard` → 应跳转到 `/login`
  - 退出后访问 `/plan` → 应跳转到 `/login`
  - 退出后访问 `/stats` → 应跳转到 `/login`

---

## 🔟 边界情况测试

### 异常处理
- [ ] **网络错误**
  - 断网后尝试操作
  - 应显示友好错误提示

- [ ] **API 错误**
  - 数据库连接失败
  - 应显示"服务器错误"

- [ ] **无效数据**
  - 提交空表单 → 应阻止提交
  - 提交负数 → 应显示验证错误

### 性能测试
- [ ] **页面加载速度**
  - 首屏加载 < 3 秒
  - 页面切换流畅

- [ ] **API 响应时间**
  - 大多数 API < 2 秒
  - 无明显卡顿

---

## 📱 移动端测试

### 响应式布局
- [ ] **移动设备适配**
  - iPhone (375px)
  - Android (360px)
  - iPad (768px)

- [ ] **触摸区域**
  - 所有按钮至少 44x44px
  - 点击无误触

- [ ] **底部导航**
  - 固定在底部
  - 活跃状态高亮
  - iOS 安全区域适配

---

## 🎯 核心业务逻辑测试

### 碳循环计算
- [ ] **112113 模式**
  - 第1天：低碳
  - 第2天：低碳
  - 第3天：中碳
  - 第4天：低碳
  - 第5天：低碳
  - 第6天：高碳
  - 第7天：重新开始（低碳）

- [ ] **营养素计算**
  - 碳水：低碳1g/kg，中碳2g/kg，高碳3g/kg
  - 蛋白质：根据体脂率计算
  - 脂肪：与碳水互补
  - 总热量：自动计算

### 数据完整性
- [ ] **数据同步**
  - 前端 → 数据库保存成功
  - 数据库 → 前端加载正确
  - 不同页面数据一致

---

## ✅ 代码层面验证（已通过）

| 检查项 | 状态 | 说明 |
|--------|------|------|
| TypeScript 编译 | ✅ | 无类型错误 |
| 生产构建 | ✅ | 42路由编译成功 |
| Header 退出按钮 | ✅ | 4个主要页面都有 |
| Logout API | ✅ | 清除双重 cookie |
| clearCurrentUser | ✅ | 清除 cookie + localStorage |
| 用户隔离逻辑 | ✅ | 所有 API 使用 getCurrentUser() |
| 数据库关联 | ✅ | 所有表正确关联 userId |

---

## 🚀 测试执行计划

### 自动化测试（建议）
```bash
# 安装测试框架
npm install -D @playwright/test

# 编写 E2E 测试
tests/
├── auth.spec.ts         # 认证测试
├── plan.spec.ts         # 计划测试
├── nutrition.spec.ts    # 营养测试
└── isolation.spec.ts    # 数据隔离测试

# 运行测试
npx playwright test
```

### 手动测试（当前）
1. 访问 https://suton.cn
2. 按照本清单逐项测试
3. 记录测试结果
4. 发现问题 → 创建 Issue

---

## 📝 测试日志模板

### 测试记录格式
```
日期: 2026-02-04
测试人: [姓名]
环境: 生产环境 (https://suton.cn)
浏览器: Chrome 120 / Safari 17

测试结果:
✅ 用户注册 - 通过
✅ 用户登录 - 通过
❌ 历史记录补充 - 失败（原因：XXX）
...

问题列表:
1. [严重] 用户登录后无法加载数据
2. [中等] 营养进度环显示不准确
3. [轻微] 按钮样式在 Safari 不一致
```

---

## 🎯 测试优先级

### P0（必须通过）
1. 用户注册/登录
2. 创建计划
3. 今日营养录入
4. 数据隔离
5. 退出登录

### P1（重要）
1. 历史记录补充
2. 控糖打卡
3. 运动记录
4. Dashboard 数据展示

### P2（建议）
1. 趋势图显示
2. 目标管理
3. 移动端适配
4. 性能优化

---

## 📊 测试完成标准

- ✅ P0 所有项通过（100%）
- ✅ P1 至少 80% 通过
- ✅ P2 至少 60% 通过
- ✅ 无 P0 级别 Bug
- ✅ 数据隔离 100% 可靠

---

**开始测试**: 访问 https://suton.cn  
**问题反馈**: 创建 GitHub Issue  
**文档更新**: 2026-02-04
